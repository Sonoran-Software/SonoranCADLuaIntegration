"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CMSServerManager = void 0;
const CMSServer_1 = require("../structures/CMSServer");
const CacheManager_1 = require("./CacheManager");
class CMSServerManager extends CacheManager_1.CacheManager {
    constructor(instance, manager) {
        super(instance, CMSServer_1.CMSServer, []);
        (async () => {
            var _a;
            while (!manager.ready) {
                await new Promise((resolve) => {
                    setTimeout(resolve, 100);
                });
            }
            try {
                const serversRes = await ((_a = manager.rest) === null || _a === void 0 ? void 0 : _a.request('GET_GAME_SERVERS'));
                const servers = serversRes.servers;
                servers.forEach((server) => {
                    const serverStruct = {
                        id: server.id,
                        config: server
                    };
                    this._add(serverStruct, true, server.id);
                });
                console.log(`Found ${servers.length} servers`);
            }
            catch (err) {
                throw new Error(String(err));
            }
        })();
    }
}
exports.CMSServerManager = CMSServerManager;
